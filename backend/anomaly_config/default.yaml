# 全局检测模式配置: keyword, regex, mixed
detection_mode: mixed

log_paths:
  - "/var/log"
  - "./test.log"

detectors:
  oom:
    enabled: true
    detection_mode: mixed
    keywords:
      - "Out of memory"
      - "oom-killer"
      - "Killed process"
      - "Memory cgroup out of memory"
    regex_patterns:
      - "(?:Out\\s+of\\s+memory|OOM).*?(?:kill|terminat).*?process.*?\\d+"
      - "oom.*?killer.*?invoked.*?(?:gfp_mask|order)=\\w+"
      - "(?:Killed|terminated).*?process.*?\\d+.*?(?:total-vm|rss).*?\\d+[kKmMgG]?B"
      - "Memory.*?cgroup.*?out.*?memory.*?(?:usage|limit).*?\\d+"
      - "oom_score.*?\\d+.*?pid.*?\\d+.*?total_vm.*?\\d+"
      - "page allocation failure.*?order.*?\\d+"
      - "compact.*?failed.*?order.*?\\d+"
      - "swap.*?full.*?cannot.*?swap.*?out"
    
  panic:
    enabled: true
    detection_mode: mixed
    keywords:
      - "Kernel panic"
      - "kernel panic"
      - "not syncing"
      - "System halted"
      - "sysrq triggered crash"
      - "Unable to mount root"
    regex_patterns:
      - "(?:Kernel|kernel).*?panic.*?(?:not.*?syncing|System.*?halted)"
      - "panic.*?(?:CPU|PID).*?\\d+.*?(?:not.*?syncing|System.*?halted)"
      - "(?:sysrq|SysRq).*?trigger.*?crash.*?Kernel.*?panic"
      - "(?:Unable to mount|Cannot mount).*?root.*?(?:filesystem|device)"
      - "(?:VFS|Virtual File System).*?mount.*?root.*?failed"
      - "end.*?Kernel.*?panic.*?(?:not.*?tty|sysrq)"
      - "BUG.*?unable.*?handle.*?(?:kernel|NULL).*?at.*?0x[\\da-fA-F]+"
      - "general protection fault.*?ip:.*?[\\da-fA-F]+.*?error:.*?\\d+"
      
  reboot:
    enabled: true
    detection_mode: mixed
    keywords:
      - "unexpectedly shut down"
      - "unexpected restart"
      - "system reboot"
      - "restart triggered by hardware"
    regex_patterns:
      - "(?:unexpected|unclean).*?(?:shut.*?down|restart|reboot)"
      - "system.*?(?:reboot|restart).*?(?:initiated|triggered)"
      - "(?:watchdog|hardware).*?trigger.*?(?:reboot|restart)"
      - "power.*?(?:failure|loss).*?shut.*?down"
      - "ACPI.*?enter.*?(?:S5|shutdown|reboot)"
      - "systemd.*?reboot.*?target.*?start"
      - "kernel.*?restart.*?preparing"
      - "emergency.*?restart.*?initiated"
  
  oops:
    enabled: true
    detection_mode: mixed
    keywords:
      - "Oops:"
      - "general protection fault"
      - "kernel BUG at"
      - "Unable to handle kernel"
      - "WARNING: CPU:"
      - "BUG: unable to handle kernel"
      - "invalid opcode:"
      - "stack segment:"
    regex_patterns:
      - "Oops.*?(?:general protection|GPF).*?IP.*?[\\da-fA-Fx]+"
      - "(?:kernel|Kernel).*?BUG.*?at.*?[\\w/]+\\.(?:c|h):\\d+"
      - "(?:Unable to handle|Cannot handle).*?(?:kernel|NULL).*?pointer"
      - "WARNING.*?CPU.*?\\d+.*?PID.*?\\d+.*?at.*?[\\w/]+"
      - "BUG.*?unable.*?handle.*?(?:kernel|page).*?fault"
      - "invalid.*?opcode.*?IP.*?[\\da-fA-Fx]+"
      - "stack.*?segment.*?fault.*?address.*?[\\da-fA-Fx]+"
      - "RIP.*?[\\da-fA-Fx]+.*?Code.*?(?:Oops|BUG)"
      - "Call.*?Trace.*?(?:\\[\\w+\\]|do_one_initcall)"
      - "divide.*?error.*?CPU.*?\\d+.*?IP.*?[\\da-fA-Fx]+"
      
  deadlock:
    enabled: true
    detection_mode: mixed
    keywords:
      - "possible deadlock"
      - "lock held"
      - "blocked for"
      - "stalled for"
      - "hung task"
      - "task blocked"
      - "soft lockup"
      - "hard lockup"
      - "blocked for more than 120 seconds"
      - "task hung"
      - "Show Blocked State"
      - "Call Trace for"
    regex_patterns:
      - "(?:possible|potential).*?deadlock.*?(?:detected|found)"
      - "INFO.*?task.*?blocked.*?more.*?\\d+.*?seconds"
      - "task.*?\\w+.*?state.*?[RD].*?blocked.*?\\d+.*?seconds"
      - "(?:soft|hard).*?lockup.*?CPU.*?\\d+.*?stuck.*?\\d+"
      - "hung.*?task.*?state.*?[RD].*?blocked"
      - "Show.*?Blocked.*?State.*?task.*?state.*?[RD]"
      - "Call.*?Trace.*?for.*?(?:mutex_lock|spin_lock)"
      - "detected.*?deadlock.*?between.*?\\w+.*?and.*?\\w+"
      - "lock.*?held.*?by.*?\\w+.*?waiting.*?for.*?\\w+"
      - "circular.*?dependency.*?detected.*?\\w+.*?\\w+"

  fs_exception:
    enabled: true
    detection_mode: mixed
    keywords:
      - "filesystem error"
      - "EXT4-fs error"
      - "XFS error"
      - "I/O error"
      - "file system corruption"
      - "superblock corrupt"
      - "metadata corruption"
      - "fsck needed"
      - "Buffer I/O error"
    regex_patterns:
      - "(?:filesystem|file system).*?error.*?(?:corrupt|damage)"
      - "(?:EXT4|XFS|BTRFS|NTFS).*?(?:error|corruption).*?detected"
      - "I/O.*?error.*?dev.*?\\w+.*?(?:sector|logical).*?\\d+"
      - "(?:superblock|metadata).*?corrupt.*?(?:run.*?fsck|repair)"
      - "Buffer.*?I/O.*?error.*?dev.*?\\w+.*?logical.*?\\d+"
      - "journal.*?abort.*?I/O.*?error"
      - "file.*?system.*?corruption.*?(?:detected|found)"
      - "fsck.*?needed.*?(?:filesystem|partition)"
      - "read.*?error.*?sector.*?\\d+.*?device.*?\\w+"
      - "write.*?error.*?sector.*?\\d+.*?device.*?\\w+"