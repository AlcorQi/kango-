<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Linux系统异常监控</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"/>
<link href="./assets/styles.css" rel="stylesheet"/>
<!-- 轻量级 Markdown 渲染，用于展示 LLM 分析报告 -->
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>
<body>
<header>
  <div class="title">🖥️ Linux系统异常监控 - Dashboard</div>
  <div class="actions">
    <a class="btn ghost" href="./history.html">历史查询</a>
    <a class="btn ghost" href="./settings.html">配置管理</a>
    <button id="btn-refresh" class="btn primary">刷新</button>
  </div>
</header>
<div class="container">
  <div id="toast" style="display:none"></div>
      <div class="grid">
        <div class="card">
          <h3>异常总数</h3>
          <div id="metric-total" class="metric">-</div>
        </div>
        <div class="card">
      <h3>严重异常</h3>
      <div id="metric-critical" class="metric">-</div>
    </div>
    <div class="card">
      <h3>检测状态</h3>
          <div class="status"><span class="dot ok"></span><span id="metric-status">运行中</span></div>
          <div style="margin-top:8px;color:#a7b1c9">最后检测到新异常时间：<span id="metric-last">-</span></div>
          <div style="margin-top:4px;color:#a7b1c9">最后扫描时间：<span id="metric-last-scan">-</span></div>
        </div>
        <div class="card">
          <h3>机器筛选</h3>
          <select id="host-filter" class="input" style="width:100%">
            <option value="">全部机器</option>
          </select>
          <div class="hint" style="margin-top:4px;font-size:12px">选择特定机器查看其异常统计</div>
        </div>
      </div>

  <div class="row" style="margin-top:16px">
    <div class="card" style="flex:1">
      <div class="toolbar"><div style="font-weight:600;color:#a7b1c9">最新异常事件</div></div>
      <table class="table">
        <thead>
          <tr>
            <th>时间</th>
            <th>级别</th>
            <th>类型</th>
            <th>信息</th>
            <th>主机</th>
            <th>来源</th>
          </tr>
        </thead>
        <tbody id="latest-body"></tbody>
      </table>
    </div>
  </div>

  <div class="row" style="margin-top:12px">
    <div class="card" style="flex:1">
      <div class="toolbar"><div style="font-weight:600;color:#a7b1c9">异常类型分布</div></div>
      <div class="chart-wrap"><canvas id="typeChart"></canvas></div>
    </div>
  </div>

  <div class="row" style="margin-top:16px">
    <div class="card" style="flex:1; max-height:600px; overflow:auto">
      <div class="toolbar">
        <div style="font-weight:600;color:#a7b1c9">AI 建议（LLM 分析报告）</div>
        <div style="display:flex;gap:8px">
          <button id="btn-ai-refresh" class="btn ghost" disabled>刷新分析</button>
          <button id="btn-ai-generate" class="btn primary">生成AI建议</button>
        </div>
      </div>
      <div id="ai-list" class="markdown-body"></div>
    </div>
  </div>

  <div class="footer">© 系统异常检测</div>
</div>

<div id="drawer-overlay" class="drawer-overlay"></div>
<div id="type-drawer" class="drawer">
  <div class="drawer-header">
    <h3 id="drawer-title">类型详情</h3>
    <button id="drawer-close" class="btn ghost" style="border:none;font-size:24px;padding:0 8px">×</button>
  </div>
  <div class="drawer-body">
    <div class="card" style="background:#0f1a37; border:1px solid #2a355e">
      <h4>24小时趋势</h4>
      <div class="chart-wrap" style="height:200px">
        <canvas id="drawerChart"></canvas>
      </div>
    </div>
    <div class="card" style="margin-top:16px; background:#0f1a37; border:1px solid #2a355e">
      <h4>最新事件</h4>
      <div style="overflow-x:auto">
        <table class="table" style="font-size:12px">
          <tbody id="drawer-list"></tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<script type="module" src="./assets/dashboard.js?v=2"></script>
</body>
</html>
